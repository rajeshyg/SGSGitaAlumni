graph TB
    subgraph "ğŸ–¥ï¸ UI LAYER - Pages & Routes"
        PostingsPage["/postings<br/>PostingsPage.tsx<br/>ğŸ“„ Lists all postings with filters<br/>âœ… Type: offer_support/seek_support<br/>âœ… Category: dynamic from API<br/>âœ… Domain: filter by domain<br/>âœ… Search: title/content/tags<br/>âœ… Matched postings toggle"]
        MemberDashboard["/dashboard<br/>MemberDashboard.tsx<br/>ğŸ  Unified dashboard<br/>âœ… Single cohesive view<br/>âœ… Direct API integration<br/>âœ… No tabs (removed feed system)"]
        MyPostingsPage["/postings/my<br/>MyPostingsPage.tsx<br/>ğŸ‘¤ User's own postings<br/>âœ… View all statuses<br/>âœ… Edit pending posts<br/>âœ… Archive/delete posts<br/>âœ… Show archived toggle"]
        CreatePostingPage["/postings/new<br/>CreatePostingPage.tsx<br/>â• 4-step creation wizard<br/>âœ… Step 1: Type & Category<br/>âœ… Step 2: Details & Domains<br/>âœ… Step 3: Logistics & Urgency<br/>âœ… Step 4: Contact & Preview"]
        EditPostingPage["/postings/:id/edit<br/>EditPostingPage.tsx<br/>âœï¸ Edit pending postings<br/>âœ… Modify content & domains<br/>âœ… Re-submit for review"]
    end

    subgraph "ğŸ¨ UI LAYER - Dashboard Components"
        MemberDashboard --> PersonalizedPosts["PersonalizedPosts.tsx<br/>âœ… Shows recent postings (limit 5)<br/>âœ… Fetches from /api/postings<br/>âœ… Uses PostingCard<br/>âœ… No separate feed system"]
        MemberDashboard --> ActivityTimeline["ActivityTimeline.tsx<br/>âœ… Activity items only<br/>âœ… Connections, events, achievements<br/>NOT postings<br/>âœ… Filtered from ACTIVITY_FEED"]
        MemberDashboard --> StatsOverview["StatsOverview.tsx<br/>ğŸ“Š User statistics"]
        MemberDashboard --> QuickActions["QuickActions.tsx<br/>âš¡ Action buttons<br/>âœ… Includes Moderation Queue link"]
        MemberDashboard --> RecentConversations["RecentConversations.tsx<br/>ğŸ’¬ Chat previews"]
        MemberDashboard --> OpportunitiesSpotlight["OpportunitiesSpotlight.tsx<br/>ğŸ¯ Matched opportunities"]
        MemberDashboard --> DomainFocusCard["DomainFocusCard.tsx<br/>ğŸ“ Domain focus areas"]
        MemberDashboard --> RecommendedConnections["RecommendedConnections.tsx<br/>ğŸ‘¥ Uses ConnectionCard"]
        MemberDashboard --> PendingActions["PendingActions.tsx<br/>ğŸ“‹ Uses ActionCard"]
    end

    subgraph "ğŸ§© UI LAYER - Shared Components"
        PostingCard["PostingCard.tsx<br/>âœ… CANONICAL component<br/>Single source of truth<br/>Renders: badges, domains, tags,<br/>location, author, actions<br/>ğŸ’³ Shows posting ID<br/>âœ… Modern CommentInput<br/>âœ… Like/Comment/Share buttons<br/>âœ… Domain hierarchy display"]
        CommentInput["CommentInput.tsx<br/>ğŸ’¬ Modern inline comment<br/>âœ… Replaces browser prompt()<br/>âœ… Keyboard shortcuts (Ctrl+Enter)<br/>âœ… Cancel on Escape<br/>âœ… Loading states"]
        UserProfileCard["UserProfileCard.tsx<br/>ğŸ‘¤ Reusable profile display<br/>3 variants: compact/default/detailed"]
        ConnectionCard["ConnectionCard.tsx<br/>ğŸ‘¥ Reusable connection card<br/>âœ… Avatar, badges, actions"]
        ActionCard["ActionCard.tsx<br/>âš¡ Reusable action card<br/>âœ… Priority, progress, metadata"]
        PostingPreview["PostingPreview.tsx<br/>ğŸ‘ï¸ Preview in creation wizard"]
        StepIndicator["StepIndicator.tsx<br/>ğŸ“ 4-step wizard progress"]
        SelectionCard["SelectionCard.tsx<br/>ğŸ”² Visual selection cards"]
    end

    subgraph "ğŸŒ API LAYER - Services"
        APIService["APIService.ts<br/>ğŸ”Œ API Client<br/>Handles all HTTP requests<br/>âœ… GET/POST/PUT/DELETE methods"]
    end

    subgraph "ğŸŒ API LAYER - Endpoints"
        PostingsListEndpoint["GET /api/postings<br/>ğŸ“¡ Lists postings with filters<br/>âœ… status, type, category, domain<br/>âœ… search, location_type, urgency<br/>âœ… limit, offset pagination<br/>âœ… Default: active + approved only"]
        PostingsDetailEndpoint["GET /api/postings/:id<br/>ğŸ“¡ Full posting with joins<br/>âœ… domains, tags, attachments<br/>âœ… Increments view_count"]
        MatchedPostingsEndpoint["GET /api/postings/matched/:userId<br/>ğŸ¯ Domain-based matching<br/>âœ… Uses user preferences<br/>âœ… Areas of interest priority<br/>âœ… Only matches on granular areas"]
        MyPostingsEndpoint["GET /api/postings/my/:userId<br/>ğŸ‘¤ User's own postings<br/>âœ… All statuses (no filtering)<br/>âœ… Requires ownership auth"]
        CategoriesEndpoint["GET /api/postings/categories<br/>ğŸ“‘ Active categories list"]
        CreatePostingEndpoint["POST /api/postings<br/>â• Create new posting<br/>âœ… Requires auth<br/>âœ… Sets status: pending_review<br/>âœ… Links domains & tags"]
        UpdatePostingEndpoint["PUT /api/postings/:id<br/>âœï¸ Update posting<br/>âœ… Requires ownership<br/>âœ… Updates domains/tags"]
        DeletePostingEndpoint["DELETE /api/postings/:id<br/>ğŸ—‘ï¸ Archive posting<br/>âœ… Soft delete (status: archived)<br/>âœ… Requires ownership"]
        LikeEndpoint["POST /api/postings/:id/like<br/>â¤ï¸ Toggle like<br/>âœ… Updates interest_count"]
        CommentEndpoint["POST /api/postings/:id/comment<br/>ğŸ’¬ Add comment<br/>âœ… Requires auth<br/>âœ… Updates comment_count"]
        ModerationQueueEndpoint["GET /api/moderation/queue<br/>ğŸ‘® Moderation queue<br/>âœ… Pending postings<br/>âœ… Requires moderator role"]
        ApproveEndpoint["POST /api/moderation/approve<br/>âœ… Approve posting<br/>âœ… Sets status: approved<br/>âœ… Creates moderation history"]
        RejectEndpoint["POST /api/moderation/reject<br/>âŒ Reject posting<br/>âœ… Sets status: rejected<br/>âœ… Requires feedback<br/>âœ… Creates moderation history"]
    end

    subgraph "ğŸ’¾ DATABASE LAYER"
        PostingsTable[("POSTINGS<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>id PK char(36) UUID<br/>title varchar<br/>content text<br/>posting_type enum<br/>category_id FK<br/>author_id FK bigint<br/>status enum<br/>moderation_status varchar<br/>urgency_level enum<br/>location varchar<br/>location_type enum<br/>duration varchar<br/>contact_name varchar<br/>contact_email varchar<br/>contact_phone varchar<br/>expires_at datetime<br/>view_count int<br/>interest_count int<br/>comment_count int<br/>is_pinned boolean<br/>published_at datetime<br/>created_at datetime<br/>updated_at datetime<br/>moderated_by bigint<br/>moderated_at datetime<br/>moderator_feedback text<br/>moderator_notes text")]
        
        UsersTable[("APP_USERS<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>id PK bigint<br/>first_name varchar<br/>last_name varchar<br/>email varchar<br/>role enum<br/>is_family_account boolean<br/>âœ… Fixed NULL names")]
        
        DomainsTable[("DOMAINS<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>id PK char(36) UUID<br/>name varchar<br/>description text<br/>icon varchar<br/>color_code varchar<br/>domain_level enum<br/>parent_domain_id FK<br/>âœ… 3-level hierarchy")]
        
        TagsTable[("TAGS<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>id PK char(36) UUID<br/>name varchar<br/>tag_type enum<br/>is_approved boolean<br/>âœ… Moderated tag system")]
        
        CategoriesTable[("POSTING_CATEGORIES<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>id PK char(36) UUID<br/>name varchar<br/>description text<br/>parent_category_id FK<br/>category_type enum<br/>is_active boolean")]
        
        PostingDomainsJoin[("POSTING_DOMAINS<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>id PK char(36) UUID<br/>posting_id FK<br/>domain_id FK<br/>is_primary boolean<br/>âœ… Supports multiple domains")]
        
        PostingTagsJoin[("POSTING_TAGS<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>id PK char(36) UUID<br/>posting_id FK<br/>tag_id FK<br/>âœ… Many-to-many tags")]
        
        LikesTable[("POSTING_LIKES<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>id PK char(36) UUID<br/>posting_id FK<br/>user_id FK bigint<br/>created_at datetime<br/>âœ… Toggle like system")]
        
        CommentsTable[("POSTING_COMMENTS<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>id PK char(36) UUID<br/>posting_id FK<br/>user_id FK bigint<br/>comment_text text<br/>created_at datetime<br/>âœ… Comment threads")]
        
        ModerationHistoryTable[("MODERATION_HISTORY<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>id PK char(36) UUID<br/>posting_id FK<br/>moderator_id FK bigint<br/>action enum<br/>reason enum<br/>feedback text<br/>notes text<br/>created_at datetime<br/>âœ… Audit trail")]
        
        ActivityFeedTable[("ACTIVITY_FEED<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>id PK char(36) UUID<br/>user_id FK bigint<br/>item_type enum<br/>item_id FK<br/>title varchar<br/>content text<br/>timestamp datetime<br/>âœ… Filtered: connection,<br/>event, achievement<br/>NOT postings")]
        
        UserPreferencesTable[("USER_PREFERENCES<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>user_id PK bigint<br/>primary_domain_id char(36)<br/>secondary_domain_ids JSON<br/>areas_of_interest_ids JSON<br/>âœ… Domain matching source")]
    end

    subgraph "âœ… ARCHITECTURAL IMPROVEMENTS"
        UnifiedDashboard["âœ… Unified dashboard<br/>Removed tabs (Overview/Feed)<br/>Single cohesive view<br/>Direct API integration"]
        RemovedFeedSystem["âœ… Removed feed system<br/>routes/feed.js DELETED<br/>FeedCard.tsx DELETED<br/>FeedAdapter.ts DELETED<br/>500+ lines removed"]
        CanonicalPostingCard["âœ… Consistent posting display<br/>PostingCard used everywhere<br/>Same data source & props<br/>Modern CommentInput"]
        ModernCommentInput["âœ… Modern CommentInput<br/>Replaces browser prompt()<br/>Keyboard shortcuts<br/>Better UX"]
        DomainBasedMatching["âœ… Domain-based matching<br/>Uses user preferences<br/>Areas of interest priority<br/>Granular matching"]
        ProperModeration["âœ… Proper moderation workflow<br/>Separate moderation API<br/>Audit history<br/>Role-based access"]
        StatusManagement["âœ… Clear status management<br/>pending_review â†’ approved/rejected<br/>Soft delete (archived)<br/>Status transitions"]
    end

    subgraph "ğŸ”§ WORKFLOW FIXES"
        CreationWorkflow["ğŸ› Creation workflow<br/>4-step wizard<br/>Domain selection hierarchy<br/>Contact info collection<br/>Preview before submit"]
        ModerationWorkflow["ğŸ› Moderation workflow<br/>Queue for pending posts<br/>Approve/reject with feedback<br/>History tracking<br/>Role validation"]
        UserManagement["ğŸ› User posting management<br/>My Postings page<br/>Edit pending posts<br/>Archive own posts<br/>Status visibility"]
        MatchingAlgorithm["ğŸ› Matching algorithm<br/>Fixed domain assignments<br/>User preference based<br/>Prioritizes specificity<br/>No irrelevant matches"]
        DataQuality["ğŸ› Data quality fixes<br/>Author names populated<br/>Domain relationships corrected<br/>Foreign key constraints<br/>Type consistency"]
        UIImprovements["ğŸ› UI improvements<br/>Responsive design<br/>44px touch targets<br/>Loading states<br/>Error handling<br/>Accessibility"]
    end

    %% PostingsPage flow
    PostingsPage -->|"GET /api/postings"| APIService
    APIService -->|"filters: type, category, domain, search"| PostingsListEndpoint
    APIService -->|"GET /api/postings/matched/:userId"| MatchedPostingsEndpoint
    APIService -->|"GET /api/postings/categories"| CategoriesEndpoint
    PostingsListEndpoint -->|"queries with joins"| PostingsTable
    PostingsListEndpoint --> UsersTable
    PostingsListEndpoint --> CategoriesTable
    PostingsListEndpoint --> PostingDomainsJoin
    PostingsListEndpoint --> PostingTagsJoin
    PostingsTable -->|"full posting objects"| PostingsPage
    PostingsPage -->|"âœ… canonical props"| PostingCard
    PostingCard -->|"modern comment UI"| CommentInput

    %% Dashboard PersonalizedPosts flow
    MemberDashboard --> PersonalizedPosts
    PersonalizedPosts -->|"GET /api/postings?status=active&limit=5"| APIService
    APIService -->|"recent active postings"| PersonalizedPosts
    PersonalizedPosts -->|"âœ… canonical props"| PostingCard

    %% My Postings flow
    MyPostingsPage -->|"GET /api/postings/my/:userId"| APIService
    APIService --> MyPostingsEndpoint
    MyPostingsEndpoint -->|"all user postings"| PostingsTable
    MyPostingsEndpoint --> PostingDomainsJoin
    MyPostingsEndpoint --> PostingTagsJoin

    %% Creation flow
    CreatePostingPage -->|"POST /api/postings"| APIService
    APIService --> CreatePostingEndpoint
    CreatePostingEndpoint -->|"status: pending_review"| PostingsTable
    CreatePostingEndpoint --> PostingDomainsJoin
    CreatePostingEndpoint --> PostingTagsJoin

    %% Moderation flow
    ModerationQueueEndpoint -->|"pending_review postings"| PostingsTable
    ApproveEndpoint -->|"status: approved"| PostingsTable
    ApproveEndpoint --> ModerationHistoryTable
    RejectEndpoint -->|"status: rejected"| PostingsTable
    RejectEndpoint --> ModerationHistoryTable

    %% ActivityTimeline (ACTIVITY ONLY)
    ActivityTimeline -->|"filtered query"| ActivityFeedTable
    ActivityTimeline -.->|"âœ… renders activity only<br/>connections, events, achievements<br/>NO postings"| ActivityTimeline

    %% API Service connections
    APIService --> PostingsDetailEndpoint
    APIService --> UpdatePostingEndpoint
    APIService --> DeletePostingEndpoint
    APIService --> LikeEndpoint
    APIService --> CommentEndpoint
    APIService --> ModerationQueueEndpoint
    APIService --> ApproveEndpoint
    APIService --> RejectEndpoint

    %% Database relationships
    PostingsTable ---|"author_id"| UsersTable
    PostingsTable ---|"category_id"| CategoriesTable
    PostingsTable ---|"many-to-many"| PostingDomainsJoin
    PostingDomainsJoin ---|"domain_id"| DomainsTable
    PostingsTable ---|"many-to-many"| PostingTagsJoin
    PostingTagsJoin ---|"tag_id"| TagsTable
    PostingsTable ---|"one-to-many"| LikesTable
    LikesTable ---|"user_id"| UsersTable
    PostingsTable ---|"one-to-many"| CommentsTable
    CommentsTable ---|"user_id"| UsersTable
    PostingsTable ---|"one-to-many"| ModerationHistoryTable
    ModerationHistoryTable ---|"moderator_id"| UsersTable
    ActivityFeedTable ---|"user_id"| UsersTable
    UserPreferencesTable ---|"user_id"| UsersTable
    UserPreferencesTable -.->|"matching source"| MatchedPostingsEndpoint

    %% Action handlers
    PostingCard -->|"onLike(posting.id)"| LikeEndpoint
    PostingCard -->|"onComment(posting.id, text)"| CommentEndpoint
    LikeEndpoint --> LikesTable
    CommentEndpoint --> CommentsTable

    %% Workflow connections
    CreatePostingPage -.->|"creates"| PostingsTable
    PostingsTable -.->|"pending_review"| ModerationQueueEndpoint
    ModerationQueueEndpoint -.->|"reviewed by"| ApproveEndpoint
    ApproveEndpoint -.->|"approved"| PostingsListEndpoint
    MyPostingsPage -.->|"manages"| PostingsTable
    EditPostingPage -.->|"updates"| UpdatePostingEndpoint

    %% Architecture highlights
    PersonalizedPosts -.-> UnifiedDashboard
    MemberDashboard -.-> RemovedFeedSystem
    PostingCard -.-> CanonicalPostingCard
    CommentInput -.-> ModernCommentInput
    MatchedPostingsEndpoint -.-> DomainBasedMatching
    ModerationHistoryTable -.-> ProperModeration
    MyPostingsPage -.-> StatusManagement

    %% Fixes applied
    CreatePostingPage -.-> CreationWorkflow
    ModerationQueueEndpoint -.-> ModerationWorkflow
    MyPostingsPage -.-> UserManagement
    MatchedPostingsEndpoint -.-> MatchingAlgorithm
    UsersTable -.-> DataQuality
    PostingCard -.-> UIImprovements

    %% Styling
    classDef canonical fill:#22c55e,stroke:#16a34a,stroke-width:4px,color:#fff
    classDef database fill:#8b5cf6,stroke:#7c3aed,stroke-width:2px,color:#fff
    classDef api fill:#f59e0b,stroke:#d97706,stroke-width:2px,color:#fff
    classDef correct fill:#10b981,stroke:#059669,stroke-width:2px,color:#fff
    classDef newComponent fill:#3b82f6,stroke:#2563eb,stroke-width:3px,color:#fff
    classDef fixes fill:#ef4444,stroke:#dc2626,stroke-width:2px,color:#fff
    classDef workflow fill:#f59e0b,stroke:#d97706,stroke-width:3px,color:#fff

    class PostingCard,PostingsListEndpoint canonical
    class PostingsTable,UsersTable,DomainsTable,TagsTable,CategoriesTable,PostingDomainsJoin,PostingTagsJoin,LikesTable,CommentsTable,ModerationHistoryTable,ActivityFeedTable,UserPreferencesTable database
    class PostingsDetailEndpoint,MatchedPostingsEndpoint,MyPostingsEndpoint,CategoriesEndpoint,CreatePostingEndpoint,UpdatePostingEndpoint,DeletePostingEndpoint,LikeEndpoint,CommentEndpoint,ModerationQueueEndpoint,ApproveEndpoint,RejectEndpoint api
    class PersonalizedPosts,ActivityTimeline,MemberDashboard,PostingsPage,MyPostingsPage,CreatePostingPage,EditPostingPage correct
    class CommentInput,UserProfileCard,ConnectionCard,ActionCard,PostingPreview,StepIndicator,SelectionCard newComponent
    class CreationWorkflow,ModerationWorkflow,UserManagement,MatchingAlgorithm,DataQuality,UIImprovements fixes
    class UnifiedDashboard,RemovedFeedSystem,CanonicalPostingCard,ModernCommentInput,DomainBasedMatching,ProperModeration,StatusManagement workflow